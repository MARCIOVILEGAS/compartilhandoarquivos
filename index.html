<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload e Download de Arquivos com Firebase</title>
</head>
<body>
    <h1>Upload de Múltiplos Arquivos</h1>
    
    <!-- Permitir múltiplos arquivos com o atributo 'multiple' -->
    <input type="file" id="fileInput" multiple>
    <button onclick="uploadFiles()">Upload</button>

    <h2>Arquivos Disponíveis para Download</h2>
    <div id="fileList"></div>

    <!-- Firebase SDKs via CDN -->
    <!-- Firebase App (base SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>

    <!-- Firebase Storage SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDh-We-SNGOdjqBmt79Yuj19oRRvSG8zWI",
            authDomain: "video-do-computador-e-notebook.firebaseapp.com",
            projectId: "video-do-computador-e-notebook",
            storageBucket: "video-do-computador-e-notebook.appspot.com",
            messagingSenderId: "246060946539",
            appId: "1:246060946539:web:5c4afc8b95b3441d8b4d2e"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage(); // Defina o storage após a inicialização do Firebase

        // Função para fazer upload de múltiplos arquivos
        function uploadFiles() {
            const files = document.getElementById('fileInput').files;
            const fileList = Array.from(files); // Converte em um array

            fileList.forEach((file) => {
                const storageRef = storage.ref('uploads/' + file.name);

                storageRef.put(file).then((snapshot) => {
                    alert('Upload de ' + file.name + ' concluído!');
                    listarArquivos(); // Atualiza a lista de arquivos
                }).catch((error) => {
                    console.error('Erro no upload: ', error);
                });
            });
        }

        // Função para listar os arquivos e gerar links de download
        function listarArquivos() {
            const storageRef = storage.ref('uploads/');
            const fileListDiv = document.getElementById('fileList');
            fileListDiv.innerHTML = ''; // Limpa a lista anterior

            storageRef.listAll().then((result) => {
                if (result.items.length === 0) {
                    const noFilesMessage = document.createElement('p');
                    noFilesMessage.textContent = 'Nenhum arquivo encontrado.';
                    fileListDiv.appendChild(noFilesMessage);
                    return;
                }

                result.items.forEach((fileRef) => {
                    fileRef.getDownloadURL().then((url) => {
                        const a = document.createElement('a');
                        a.href = url;
                        a.textContent = fileRef.name;
                        a.download = fileRef.name;
                        fileListDiv.appendChild(a);
                        fileListDiv.appendChild(document.createElement('br'));
                    }).catch((error) => {
                        console.error('Erro ao obter URL de download: ', error);
                    });
                });
            }).catch((error) => {
                console.error('Erro ao listar os arquivos: ', error);
            });
        }

        // Listar arquivos ao carregar a página
        window.onload = listarArquivos;
    </script>
</body>
</html>
